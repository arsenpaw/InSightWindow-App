@page "/main"
@using AXProductApp.Interfaces
@using AXProductApp.Models.Dto
@using AXProductApp.Services
@using AXProductApp.Components
@inject AuthApiClient ApiClient
@inject NavigationManager Navigation
@inject StateContainer _stateContainer
@inject IManageFireBaseTokenService _manageFireBaseTokenService;
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">

<style>
        body {
        width: 100%;
        height: 100%;
        background-image: linear-gradient(192.13deg, #F7F7F8 0.31%, #3795BD 24.16%, #4E31AA 66.9%, #3A1078 99.69%);
        background-size: auto;
        background-attachment: fixed;
        font-family: 'Lato', sans-serif;
    }
</style>
<div class="main__container">
    <header class="header">
        <h1 class="header__title">Insight window</h1>
        <div><img class="header__search" src="https://img.icons8.com/?size=100&id=7695&format=png&color=FFFFFF" alt="Search" /></div>
        <div class="header__rectangle"></div>
    </header>



    <!-- <NavLink href="/test">Go to test</NavLink> -->

    <section class="main-section">

        @if (deviceList == null)
        {
            <p>Loading...</p>
        }
        else if (deviceList.Count() == 0)
        {
            <p>No devices found.</p>
        }
        else
        {
            @foreach (var item in deviceList)
            {
                <DeviceBlock Id=item.Id Number=number></DeviceBlock>
                number++;
            }
        }

    </section>
    <footer class="footer">
        <nav>
            <ul>
                <li><img class="all-icon" src="https://img.icons8.com/?size=100&id=6g6b5Mh-1uJ7&format=png&color=FFFFFF" /></li>
                <li><img class="all-icon" src="https://img.icons8.com/?size=100&id=PLlw4LevCJrl&format=png&color=FFFFFF" /></li>
                <li><img class="plus-icon" src="/icons/plus-icon.png" /></li>
                <li><img class="all-icon" src="https://img.icons8.com/?size=100&id=364&format=png&color=FFFFFF" /></li>
                <li><img class="all-icon" src="https://img.icons8.com/?size=100&id=7819&format=png&color=FFFFFF" /></li>
            </ul>
        </nav>
    </footer>
</div>

@code {
    private IEnumerable<DeviceDto> deviceList;
    private int number = 1;

    public async Task OnDeviceSelectAsync(Guid id)
    {
        _stateContainer.ObjectTunnel.Add(id.GetHashCode(), id);
        Navigation.NavigateTo($"/deviceDetails/{id.GetHashCode()}");
    }

    protected override async Task OnInitializedAsync()
    {
        var responce = await ApiClient.GetAsync<List<DeviceDto>>("DevicesDb/DeviceOfUser");
        if (!responce.IsSuccess || !responce.Data.Any())
        {
            deviceList = new List<DeviceDto>();
            return;
        }

        deviceList = responce.Data;

        //await _manageFireBaseTokenService.CreateToken();
    }

}